<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ page import="java.sql.*" %>

<% request.setCharacterEncoding("utf-8"); %>
<%
        Connection conn = null;
        String ID = (String) request.getParameter("userID");
        String PWD = (String) request.getParameter("userPassword");
        session.setAttribute("sid", ID);

        String sql = "SELECT * FROM user WHERE userID=?";
        String jdbcurl = "jdbc:mysql://192.168.107.128:3306/BBS";
        String dbId = "root";
        String dbPwd = "yun123";

        try {
                Class.forName("com.mysql.jdbc.Driver");
                conn = DriverManager.getConnection(jdbcurl, dbId, dbPwd);

                // Prepared Statement 사용
                PreparedStatement pstmt = conn.prepareStatement(sql);
                pstmt.setString(1, ID);
                ResultSet rs = pstmt.executeQuery();

                if (rs.next()) {
                        if (ID.equals(rs.getString(1)) && PWD.equals(rs.getString(2))) {
                                out.println("<script>");
                                out.println("alert('로그인 되었습니다.')");
                                out.println("location.href='main.jsp'");
                                out.println("</script>");
                                rs.close();
                        } else if (!PWD.equals(rs.getString(2))) {
                                rs.close();
                                out.println("<script>");
                                out.println("alert('패스워드가 잘못입력되었습니다.')");
                                out.println("location.href='login.jsp'");
                                out.println("</script>");
                        }
                } else {
                        rs.close();
                        out.println("<script>");
                        out.println("alert('존재하지 않는 아이디입니다.')");
                        out.println("location.href='login.jsp'");
                        out.println("</script>");
                }
        } catch (Exception e) {
                out.println(e.getMessage());
        } finally {
                if (conn != null) {
                        try {
                                conn.close();
                        } catch (SQLException e) {
                                out.println(e.getMessage());
                        }
                }
        }
%>

<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>로그인</title>
</head>
<body>
</body>
</html>